<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kopi Susu Mrs. DK - Segarnya Nikmat Tiada Tara</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Load Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfkHXB364WW7owocF6X9crbdneVhgPW-8&libraries=places&language=id&region=ID" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #1a5d1a;
            --light-green: #2e7d32;
            --lighter-green: #4caf50;
            --cream: #f9f3e9;
            --brown: #5d4037;
            --dark-brown: #3e2723;
            --yellow: #ffd54f;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: var(--primary-green);
            background-image: linear-gradient(to bottom right, var(--primary-green), var(--light-green));
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: rgba(26, 93, 26, 0.95);
            padding: 20px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            background-color: var(--yellow);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--dark-brown);
        }

        .logo-text h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            color: white;
            font-weight: 700;
        }

        .logo-text p {
            color: var(--cream);
            font-size: 14px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 17px;
            transition: color 0.3s;
            padding: 5px 0;
        }

        nav a:hover {
            color: var(--yellow);
            border-bottom: 2px solid var(--yellow);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        /* Hero Section */
        .hero {
            padding: 80px 0;
            background-color: rgba(249, 243, 233, 0.1);
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            margin-bottom: 40px;
        }

        .hero-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
        }

        .hero-text {
            flex: 1;
            color: white;
        }

        .hero-text h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 42px;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-text p {
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 600px;
        }

        .hero-image {
            flex: 1;
            text-align: center;
        }

        .coffee-image {
            max-width: 100%;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 8px solid var(--cream);
        }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            background-color: var(--yellow);
            color: var(--dark-brown);
            text-decoration: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 18px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
            color: white;
        }

        /* Products Section */
        .section-title {
            text-align: center;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 36px;
            margin-bottom: 50px;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 4px;
            background-color: var(--yellow);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .products {
            padding: 60px 0;
            background-color: rgba(249, 243, 233, 0.05);
            border-radius: 30px;
            margin-bottom: 40px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        .product-card {
            background-color: var(--cream);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-10px);
        }

        .product-image {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg, var(--lighter-green), var(--light-green));
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-img {
            transform: scale(1.05);
        }

        .fallback-icon {
            position: absolute;
            font-size: 60px;
            color: white;
            opacity: 0.8;
            z-index: 1;
            display: none;
        }

        .size-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--yellow);
            color: var(--dark-brown);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            z-index: 2;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .product-info {
            padding: 20px;
        }

        .product-info h3 {
            font-family: 'Poppins', sans-serif;
            color: var(--dark-brown);
            margin-bottom: 10px;
            font-size: 22px;
        }

        .product-info p {
            color: var(--brown);
            margin-bottom: 15px;
        }

        .price {
            font-size: 24px;
            font-weight: 700;
            color: var(--light-green);
            margin-bottom: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-green);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .qty-btn:hover {
            background-color: var(--primary-green);
            transform: scale(1.1);
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            border: 2px solid var(--light-green);
            border-radius: 10px;
            padding: 8px;
            background-color: white;
            color: var(--dark-brown);
        }

        .quantity-status {
            font-size: 14px;
            color: var(--light-green);
            font-weight: 600;
            text-align: center;
            margin-top: 5px;
            height: 20px;
        }

        /* Customer Form */
        .customer-form {
            background-color: var(--cream);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-brown);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Quicksand', sans-serif;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--light-green);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Location Search */
        .location-search {
            position: relative;
            margin-bottom: 10px;
            width: 100%;
        }

        .location-input {
            width: 100%;
            padding: 12px 50px 12px 15px !important;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
            height: 48px;
        }

        /* Search Button */
        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--light-green);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .search-btn:hover {
            color: var(--primary-green);
            background-color: rgba(46, 125, 50, 0.1);
        }

        .location-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .location-btn {
            flex: 1;
            padding: 12px;
            background-color: var(--light-green);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .location-btn:hover {
            background-color: var(--primary-green);
        }

        .location-btn i {
            font-size: 16px;
        }

        /* Map Container */
        .map-container {
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            border: 3px solid var(--light-green);
            display: none;
            position: relative;
        }

        #address-map {
            width: 100%;
            height: 100%;
            min-height: 250px;
        }

        .map-instruction {
            font-size: 14px;
            color: var(--brown);
            margin-top: 5px;
            text-align: center;
            font-style: italic;
        }

        /* Auto Complete Suggestions */
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .autocomplete-suggestion {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .autocomplete-suggestion:hover {
            background-color: #f5f5f5;
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: var(--light-green);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Order Summary */
        .order-summary {
            background-color: var(--cream);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: var(--shadow);
        }

        .order-summary h3 {
            color: var(--dark-brown);
            margin-bottom: 20px;
            font-family: 'Poppins', sans-serif;
            border-bottom: 2px solid var(--lighter-green);
            padding-bottom: 10px;
        }

        .order-items {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px dashed #ddd;
            background-color: rgba(76, 175, 80, 0.05);
            border-radius: 8px;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 600;
            color: var(--dark-brown);
            margin-bottom: 3px;
        }

        .order-item-qty {
            font-size: 14px;
            color: var(--brown);
        }

        .order-item-price {
            font-weight: 700;
            color: var(--light-green);
            font-size: 18px;
            min-width: 100px;
            text-align: right;
        }

        .empty-order {
            text-align: center;
            padding: 30px;
            color: var(--brown);
        }

        .empty-order i {
            font-size: 50px;
            margin-bottom: 15px;
            color: #ddd;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            font-size: 22px;
            font-weight: 700;
            color: var(--light-green);
            margin-top: 20px;
            padding-top: 20px;
            border-top: 3px solid var(--lighter-green);
        }

        /* Alert Box */
        .alert-box {
            position: fixed;
            top: 100px;
            right: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            max-width: 300px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* WhatsApp Button Container */
        .whatsapp-btn-container {
            margin-top: 30px;
            text-align: center;
        }

        .whatsapp-btn-large {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 18px 40px;
            background-color: #25D366;
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 20px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            width: 100%;
            max-width: 500px;
        }

        .whatsapp-btn-large:hover {
            background-color: #128C7E;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .whatsapp-btn-large i {
            font-size: 24px;
        }

        /* Receipt Preview */
        .receipt-preview {
            background-color: white;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            display: none;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px dashed #333;
            padding-bottom: 10px;
        }

        .receipt-header h4 {
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark-brown);
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .receipt-total {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px dashed #333;
        }

        /* Footer */
        footer {
            background-color: var(--dark-brown);
            color: var(--cream);
            padding: 50px 0 20px;
            border-top-left-radius: 40px;
            border-top-right-radius: 40px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column {
            flex: 1;
            min-width: 250px;
        }

        .footer-column h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--yellow);
        }

        .contact-info p {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            font-size: 18px;
            transition: all 0.3s;
        }

        .social-links a:hover {
            background-color: var(--yellow);
            color: var(--dark-brown);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        /* Tracking Section */
        section {
            scroll-margin-top: 100px;
            padding-top: 30px;
        }

        #tracking {
            scroll-margin-top: 120px;
            padding-top: 40px;
        }

        /* Tracking Header */
        .tracking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .live-badge {
            display: inline-block;
            background-color: #ff5252;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Tracking Search Card */
        .track-search-card {
            background-color: var(--cream);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        /* Refresh Button */
        .refresh-btn {
            background-color: var(--light-green);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            height: 50px;
            width: 50px;
            justify-content: center;
        }

        .refresh-btn:hover {
            background-color: var(--primary-green);
        }

        .refresh-btn.refreshing i {
            animation: spin 1s linear infinite;
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--light-green);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Demo ID Button */
        .demo-id-btn {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--light-green);
            border: 1px solid var(--light-green);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .demo-id-btn:hover {
            background-color: var(--light-green);
            color: white;
        }

        /* Loading Card */
        .loading-card {
            background-color: white;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .spinner-large {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--light-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        /* Default Card */
        .default-card {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: var(--shadow);
        }

        /* Tracking Status Card */
        .tracking-status-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Status Highlight */
        .status-highlight {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--light-green);
        }

        /* Progress Bar */
        .progress-container {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--light-green), var(--lighter-green));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Status Steps */
        .tracking-status {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }

        .tracking-status::before {
            content: '';
            position: absolute;
            top: 30px;
            left: 50px;
            right: 50px;
            height: 3px;
            background-color: #ddd;
            z-index: 1;
        }

        .status-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #ddd;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transition: all 0.3s ease;
        }

        .status-step.completed .status-icon {
            background-color: var(--light-green) !important;
            animation: statusPulse 2s infinite;
        }

        .status-step.active .status-icon {
            background-color: var(--yellow) !important;
            animation: statusPulse 1.5s infinite;
            box-shadow: 0 0 0 8px rgba(255, 213, 79, 0.3);
        }

        @keyframes statusPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(46, 125, 50, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0); }
        }

        .status-step h4 {
            font-family: 'Poppins', sans-serif;
            color: var(--dark-brown);
            margin-bottom: 5px;
        }

        .status-step p {
            color: var(--brown);
            font-size: 14px;
        }

        /* Order Status Badge */
        .order-status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-diterima {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .status-disiapkan {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .status-pengantaran {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .status-sampai {
            background-color: #f1f8e9;
            color: #689f38;
        }

        /* Driver Info Card */
        .driver-info-card {
            background-color: rgba(76, 175, 80, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .driver-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        /* ETA Card */
        .eta-card {
            background: linear-gradient(135deg, var(--light-green), var(--lighter-green));
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        /* Order Details Card */
        .order-details-card {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* ================================
           iOS WHATSAPP POPUP STYLES
           ================================ */
        .ios-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .ios-popup-container {
            background-color: white;
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .ios-popup-header {
            background: linear-gradient(135deg, #25D366, #128C7E);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
        }

        .ios-popup-header i {
            font-size: 50px;
            color: white;
        }

        .ios-popup-title {
            color: var(--dark-brown);
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .ios-popup-subtitle {
            color: var(--brown);
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .ios-popup-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .ios-popup-btn {
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .ios-popup-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .ios-popup-btn:active::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(100, 100);
                opacity: 0;
            }
        }

        .ios-popup-btn-primary {
            background-color: #25D366;
            color: white;
        }

        .ios-popup-btn-primary:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3);
        }

        .ios-popup-btn-secondary {
            background-color: var(--light-green);
            color: white;
        }

        .ios-popup-btn-secondary:hover {
            background-color: var(--primary-green);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 125, 50, 0.3);
        }

        .ios-popup-btn-tertiary {
            background-color: var(--yellow);
            color: var(--dark-brown);
        }

        .ios-popup-btn-tertiary:hover {
            background-color: #ffca28;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 213, 79, 0.3);
        }

        .ios-popup-instruction {
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            line-height: 1.6;
        }

        .ios-popup-close {
            background-color: #f5f5f5;
            color: #666;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .ios-popup-close:hover {
            background-color: #e0e0e0;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .hero-content {
                flex-direction: column;
                text-align: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            nav ul {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .hero-text h2 {
                font-size: 32px;
            }
            
            .alert-box {
                top: 80px;
                left: 20px;
                right: 20px;
                max-width: none;
            }
            
            .location-buttons {
                flex-direction: column;
            }
            
            .whatsapp-btn-large {
                padding: 16px 30px;
                font-size: 18px;
            }
            
            .location-input {
                font-size: 16px !important;
                padding: 14px 50px 14px 15px !important;
                height: 50px;
            }
            
            .search-btn {
                right: 8px !important;
                padding: 6px !important;
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .location-input:focus {
                border-color: var(--light-green) !important;
                outline: none;
                box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
            }
            
            .map-container {
                height: 250px;
            }
            
            .product-image {
                height: 180px;
            }
            
            .size-badge {
                top: 10px;
                right: 10px;
                font-size: 10px;
                padding: 4px 8px;
            }
            
            /* Tracking Responsive */
            .tracking-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .track-search-card {
                padding: 20px;
            }
            
            .track-search-card > div {
                flex-direction: column;
                gap: 10px;
            }
            
            .track-search-card input {
                padding: 12px 15px;
            }
            
            .tracking-status {
                flex-direction: column;
                gap: 25px;
            }
            
            .tracking-status::before {
                display: none;
            }
            
            .status-step {
                display: flex;
                align-items: center;
                gap: 15px;
                text-align: left;
            }
            
            .status-icon {
                margin: 0;
                min-width: 50px;
                min-height: 50px;
            }
            
            .progress-container {
                margin: 20px 0;
            }
            
            .tracking-status-card .btn {
                flex: 100%;
                margin-bottom: 10px;
            }
            
            /* iOS WhatsApp Popup Responsive */
            .ios-popup-container {
                padding: 25px 20px;
                border-radius: 20px;
            }
            
            .ios-popup-header {
                width: 80px;
                height: 80px;
                margin-bottom: 20px;
            }
            
            .ios-popup-header i {
                font-size: 40px;
            }
            
            .ios-popup-title {
                font-size: 21px;
            }
            
            .ios-popup-subtitle {
                font-size: 15px;
                margin-bottom: 25px;
            }
            
            .ios-popup-btn {
                padding: 16px;
                font-size: 16px;
            }
        }

        @media (max-width: 576px) {
            .section-title {
                font-size: 28px;
            }
            
            .hero {
                padding: 50px 0;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 16px;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .quantity-input {
                width: 50px;
                font-size: 18px;
            }
            
            .map-container {
                height: 200px;
            }
            
            .location-btn {
                padding: 10px;
                font-size: 13px;
            }
            
            .product-image {
                height: 160px;
            }
            
            .tracking-status-card {
                padding: 15px;
            }
            
            .status-highlight {
                padding: 15px;
            }
            
            .driver-info-card {
                padding: 15px;
            }
            
            #tracking {
                scroll-margin-top: 85px;
            }
            
            /* iPhone khusus styling */
            @media (max-width: 375px) {
                .ios-popup-container {
                    padding: 20px 15px;
                    border-radius: 15px;
                }
                
                .ios-popup-header {
                    width: 70px;
                    height: 70px;
                }
                
                .ios-popup-header i {
                    font-size: 35px;
                }
                
                .ios-popup-title {
                    font-size: 19px;
                }
                
                .ios-popup-subtitle {
                    font-size: 14px;
                    margin-bottom: 20px;
                }
                
                .ios-popup-btn {
                    padding: 14px;
                    font-size: 15px;
                }
            }
        }
        
        /* Fix untuk mobile menu */
        @media (max-width: 768px) {
            #navMenu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: var(--primary-green);
                padding: 20px;
                gap: 15px;
                box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                z-index: 100;
            }
            
            #navMenu.active {
                display: flex;
            }
        }
		
		
		
        /* ... [KEEP ALL EXISTING STYLES] ... */

        /* ================================
           LIVE TRACKING MAP STYLES
           ================================ */
        .live-tracking-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin: 20px 0;
            animation: slideUp 0.5s ease-out;
            border: 2px solid var(--light-green);
        }

        .live-tracking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .live-tracking-title {
            font-family: 'Poppins', sans-serif;
            color: var(--dark-brown);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .live-tracking-title i {
            color: var(--light-green);
        }

        .live-tracking-badge {
            background-color: #ff5252;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .live-tracking-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .live-tracking-container {
                grid-template-columns: 1fr;
            }
        }

        .live-map-container {
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid var(--light-green);
            position: relative;
        }

        #live-tracking-map {
            width: 100%;
            height: 100%;
        }

        .driver-info-sidebar {
            background-color: rgba(76, 175, 80, 0.05);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .driver-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }

        .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--light-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .driver-name {
            font-weight: 700;
            color: var(--dark-brown);
            font-size: 18px;
        }

        .driver-rating {
            color: #ff9800;
            font-size: 14px;
            margin-top: 3px;
        }

        .driver-phone {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--brown);
            margin-bottom: 15px;
            padding: 8px;
            background-color: white;
            border-radius: 8px;
        }

        .driver-phone a {
            color: var(--light-green);
            text-decoration: none;
            font-weight: 600;
        }

        .eta-display {
            background: linear-gradient(135deg, var(--light-green), var(--lighter-green));
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
        }

        .eta-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .eta-value {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
        }

        .eta-subtext {
            font-size: 12px;
            opacity: 0.8;
        }

        .tracking-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 576px) {
            .tracking-stats {
                grid-template-columns: 1fr;
            }
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--light-green);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--brown);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .map-control-btn {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
            border: none;
            font-size: 16px;
            color: var(--dark-brown);
            transition: all 0.3s;
        }

        .map-control-btn:hover {
            background-color: var(--light-green);
            color: white;
            transform: scale(1.1);
        }

        .refresh-indicator {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .route-info {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #eee;
        }

        .route-step {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }

        .route-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .route-step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--lighter-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .route-step-content {
            flex: 1;
        }

        .route-step-title {
            font-weight: 600;
            color: var(--dark-brown);
            margin-bottom: 3px;
        }

        .route-step-description {
            font-size: 12px;
            color: var(--brown);
        }

        .distance-display {
            background-color: var(--yellow);
            color: var(--dark-brown);
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
        }

        .call-driver-btn {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .call-driver-btn:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }

        .simulate-driving-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
        }

        .simulate-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .simulate-btn:hover {
            background-color: #eee;
        }

        .simulate-btn.simulate-driver {
            background-color: var(--light-green);
            color: white;
            border-color: var(--light-green);
        }

        .simulate-btn.simulate-driver:hover {
            background-color: var(--primary-green);
        }
    </style>
</head>
<body>
    <!-- WhatsApp Alert -->
    <div class="alert-box" id="whatsappAlert">
        <div class="alert-content">
            <div class="alert-icon">
                <i class="fab fa-whatsapp"></i>
            </div>
            <div>
                <strong id="alertTitle">Mengarahkan ke WhatsApp...</strong>
                <p id="alertMessage">Silakan konfirmasi pengiriman pesan</p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-coffee"></i>
                </div>
                <div class="logo-text">
                    <h1>Kopi Susu Mrs. DK</h1>
                    <p>Segarnya Nikmat Tiada Tara</p>
                </div>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav>
                <ul id="navMenu">
                    <li><a href="#home">Beranda</a></li>
                    <li><a href="#products">Produk</a></li>
                    <li><a href="#order-form">Pesan Sekarang</a></li>
                    <li><a href="#tracking">Tracking Pesanan</a></li>
                    <li><a href="#contact">Kontak</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h2>Kopi Susu Autentik dengan Cita Rasa Khas Mrs. DK</h2>
                    <p>Rasakan kenikmatan kopi susu premium dengan racikan spesial dari Mrs. DK. Dibuat dengan biji kopi pilihan dan susu segar berkualitas tinggi untuk pengalaman minum kopi yang tak terlupakan.</p>
                    <a href="#order-form" class="btn btn-whatsapp">
                        <i class="fas fa-shopping-cart"></i> Pesan Sekarang
                    </a>
                </div>
                <div class="hero-image">
                    <div class="coffee-image">
                        <i class="fas fa-coffee" style="font-size: 300px; color: var(--cream);"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products" id="products">
        <div class="container">
            <h2 class="section-title">Menu Andalan Kami</h2>
            <div class="products-grid">
                <!-- Product 1: Kopi Susu Creamy (200ml) -->
                <div class="product-card">
                    <div class="product-image">
                        <img src="botol200ml.jpeg" 
                             alt="Kopi Susu Creamy 200ml" 
                             class="product-img"
                             loading="lazy"
                             onerror="handleImageError(this, 'creamy')">
                        <i class="fas fa-mug-hot fallback-icon"></i>
                    </div>
                    <div class="product-info">
                        <h3>Kopi Susu Creamy</h3>
                        <p>Perpaduan sempurna kopi robusta dengan susu segar dan gula aren asli.</p>
                        <div class="price">Rp 15.000</div>
                        <div class="quantity-controls">
                            <button class="qty-btn minus" data-product="1" data-name="Kopi Susu Creamy" data-price="15000">-</button>
                            <input type="number" class="quantity-input" id="qty-1" value="0" min="0">
                            <button class="qty-btn plus" data-product="1" data-name="Kopi Susu Creamy" data-price="15000">+</button>
                        </div>
                        <div class="quantity-status" id="status-1"></div>
                    </div>
                </div>
                
                <!-- Product 2: Kopi Susu Gula Aren (200ml) -->
                <div class="product-card">
                    <div class="product-image">
                        <img src="cup.jpeg" 
                             alt="Kopi Susu Gula Aren 200ml" 
                             class="product-img"
                             loading="lazy"
                             onerror="handleImageError(this, 'gulaaren')">
                        <i class="fas fa-mug-hot fallback-icon"></i>
                    </div>
                    <div class="product-info">
                        <h3>Kopi Susu Gula Aren</h3>
                        <p>Kopi susu dengan gula aren asli yang memberikan rasa karamel alami.</p>
                        <div class="price">Rp 15.000</div>
                        <div class="quantity-controls">
                            <button class="qty-btn minus" data-product="2" data-name="Kopi Susu Gula Aren" data-price="15000">-</button>
                            <input type="number" class="quantity-input" id="qty-2" value="0" min="0">
                            <button class="qty-btn plus" data-product="2" data-name="Kopi Susu Gula Aren" data-price="15000">+</button>
                        </div>
                        <div class="quantity-status" id="status-2"></div>
                    </div>
                </div>
                
                <!-- Product 3: Kopi Susu Creamy 1 Liter -->
                <div class="product-card">
                    <div class="product-image">
                        <img src="1liter.jpeg" 
                             alt="Kopi Susu Creamy 1 Liter" 
                             class="product-img"
                             loading="lazy"
                             onerror="handleImageError(this, 'liter')">
                        <i class="fas fa-wine-bottle fallback-icon"></i>
                        <!-- Badge untuk ukuran 1 Liter -->
                        <span class="size-badge">1 LITER</span>
                    </div>
                    <div class="product-info">
                        <h3>Kopi Susu Creamy 1 Liter</h3>
                        <p>Kopi susu dengan tambahan rasa hazelnut yang creamy dan harum.</p>
                        <div class="price">Rp 55.000</div>
                        <div class="quantity-controls">
                            <button class="qty-btn minus" data-product="3" data-name="Kopi Susu Creamy 1 Liter" data-price="55000">-</button>
                            <input type="number" class="quantity-input" id="qty-3" value="0" min="0">
                            <button class="qty-btn plus" data-product="3" data-name="Kopi Susu Creamy 1 Liter" data-price="55000">+</button>
                        </div>
                        <div class="quantity-status" id="status-3"></div>
                    </div>
                </div>
                
                <!-- Product 4: Kopi Susu Coconut (200ml) -->
                <div class="product-card">
                    <div class="product-image">
                        <img src="botol200ml.jpeg" 
                             alt="Kopi Susu Coconut 200ml" 
                             class="product-img"
                             loading="lazy"
                             onerror="handleImageError(this, 'coconut')">
                        <i class="fas fa-coconut fallback-icon"></i>
                    </div>
                    <div class="product-info">
                        <h3>Kopi Susu Coconut</h3>
                        <p>Kopi susu dengan ekstrak kelapa alami yang memberikan aroma memikat.</p>
                        <div class="price">Rp 15.000</div>
                        <div class="quantity-controls">
                            <button class="qty-btn minus" data-product="4" data-name="Kopi Susu Coconut" data-price="15000">-</button>
                            <input type="number" class="quantity-input" id="qty-4" value="0" min="0">
                            <button class="qty-btn plus" data-product="4" data-name="Kopi Susu Coconut" data-price="15000">+</button>
                        </div>
                        <div class="quantity-status" id="status-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Customer Form Section -->
    <section class="products" id="order-form">
        <div class="container">
            <h2 class="section-title">Formulir Pemesanan</h2>
            
            <div class="customer-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customer-name"><i class="fas fa-user"></i> Nama Lengkap</label>
                        <input type="text" id="customer-name" class="form-control" placeholder="Masukkan nama lengkap Anda" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-phone"><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                        <input type="tel" id="customer-phone" class="form-control" placeholder="Contoh: 081234567890" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="location-search"><i class="fas fa-map-marker-alt"></i> Cari Alamat di Google Maps</label>
                    <div class="location-search">
                        <input type="text" id="location-search" class="location-input" placeholder="Contoh: Apartemen Kemang View, Jakarta">
                        <button type="button" id="manualSearchBtn" class="search-btn" title="Cari Alamat">
                            <i class="fas fa-search"></i>
                        </button>
                        <!-- Auto Complete Suggestions -->
                        <div class="autocomplete-suggestions" id="autocompleteSuggestions"></div>
                        <div class="location-buttons">
                            <button type="button" class="location-btn" id="detectLocation">
                                <i class="fas fa-location-crosshairs"></i> Deteksi Lokasi Saya
                            </button>
                            <button type="button" class="location-btn" id="showMap">
                                <i class="fas fa-map"></i> Tampilkan Peta
                            </button>
                        </div>
                    </div>
                    <div class="map-container" id="mapContainer">
                        <div id="address-map"></div>
                        <p class="map-instruction">Geser pin merah untuk menentukan lokasi yang tepat</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customer-address"><i class="fas fa-home"></i> Alamat Lengkap (Hasil dari peta)</label>
                    <textarea id="customer-address" class="form-control" rows="3" placeholder="Alamat akan otomatis terisi dari peta..." required readonly></textarea>
                </div>
                
                <div class="form-group">
                    <label for="manual-address"><i class="fas fa-edit"></i> Atau Ketik Alamat Manual (jika peta tidak berfungsi)</label>
                    <textarea id="manual-address" class="form-control" rows="3" placeholder="Contoh: Jl. Merdeka No. 10, Jakarta Pusat"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="customer-note"><i class="fas fa-sticky-note"></i> Catatan Pesanan (Opsional)</label>
                    <textarea id="customer-note" class="form-control" rows="2" placeholder="Contoh: Kurangi gula, tambah es, dll."></textarea>
                </div>
                
                <!-- Receipt Preview -->
                <div class="receipt-preview" id="receiptPreview">
                    <div class="receipt-header">
                        <h4>KOPI SUSU MRS. DK</h4>
                        <p>Struk Pesanan #<span id="receiptNumber">000001</span></p>
                    </div>
                    <div id="receiptItems">
                        <!-- Items will be generated here -->
                    </div>
                    <div class="receipt-total">
                        <span>TOTAL</span>
                        <span id="receiptTotal">Rp 0</span>
                    </div>
                </div>
            </div>
            
            <div class="order-summary">
                <h3><i class="fas fa-receipt"></i> Ringkasan Pesanan</h3>
                <div class="order-items" id="order-items">
                    <div class="empty-order">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Belum ada pesanan</p>
                        <p style="font-size: 14px; margin-top: 10px;">Gunakan tombol + dan - pada produk untuk menambahkan pesanan</p>
                    </div>
                </div>
                <div class="order-total">
                    <span>Total Pembayaran:</span>
                    <span id="total-price">Rp 0</span>
                </div>
                
                <!-- WhatsApp Button - Langsung arahkan tanpa modal -->
                <div class="whatsapp-btn-container">
                    <button class="whatsapp-btn-large" id="sendToWhatsApp">
                        <i class="fab fa-whatsapp"></i> Kirim Struk via WhatsApp
                    </button>
                    <p style="color: var(--brown); margin-top: 10px; font-size: 14px;">
                        Klik tombol di atas untuk langsung mengirim struk ke WhatsApp kami
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Tracking Section -->
    <section class="tracking" id="tracking">
        <div class="container">
            <div class="tracking-header">
                <h2 class="section-title" style="margin-bottom: 0;">
                    Lacak Pesanan Anda 
                    <span class="live-badge" id="liveBadge" style="display: none;">
                        <i class="fas fa-circle" style="font-size: 8px; margin-right: 5px;"></i> LIVE
                    </span>
                </h2>
                <div class="last-update" id="lastUpdateTime" style="color: var(--light-green); font-size: 14px;">
                    <!-- Last update time will be shown here -->
                </div>
            </div>
            
            <!-- Search Box with better visibility -->
            <div class="track-search-card">
                <h3 style="color: var(--dark-brown); margin-bottom: 15px; font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-search-location"></i> Cari Pesanan Anda
                </h3>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1; position: relative;">
                        <input type="text" id="trackOrderId" 
                               placeholder="Masukkan ID Pesanan Anda (Contoh: KD12345)" 
                               style="width: 100%; padding: 15px 50px 15px 15px; border-radius: 10px; border: 2px solid var(--light-green); font-size: 16px;">
                        <i class="fas fa-hashtag" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--light-green);"></i>
                    </div>
                    <button id="searchTrackBtn" class="btn" style="white-space: nowrap;">
                        <i class="fas fa-search"></i> Lacak
                    </button>
                    <button id="refreshTrackBtn" class="refresh-btn" title="Refresh status">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <p style="color: var(--brown); font-size: 14px; margin: 0;">
                        <i class="fas fa-info-circle"></i> ID Pesanan dikirim via WhatsApp setelah order
                    </p>
                    <div id="autoRefreshStatus" style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--light-green); font-size: 12px;">
                            <i class="fas fa-clock"></i> Auto-refresh setiap 10 detik
                        </span>
                        <label class="switch">
                            <input type="checkbox" id="autoRefreshToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Status Loading -->
            <div id="trackingLoading" class="loading-card" style="display: none;">
                <div class="loading-content">
                    <div class="spinner-large"></div>
                    <p style="color: var(--dark-brown); font-size: 18px; margin-top: 20px;">
                        Memuat status pesanan...
                    </p>
                    <p style="color: var(--brown); font-size: 14px; margin-top: 10px;">
                        Harap tunggu sebentar
                    </p>
                </div>
            </div>
            
            <!-- Status Content -->
            <div id="trackingContent" style="display: none;">
                <!-- Content will be dynamically loaded here -->
            </div>
            
            <!-- Default/Error State -->
            <div id="trackingDefault" class="default-card">
                <div style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-truck" style="font-size: 80px; color: var(--lighter-green); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--dark-brown); margin-bottom: 15px; font-family: 'Poppins', sans-serif;">
                        Lacak Pengiriman Pesanan
                    </h3>
                    <p style="color: var(--brown); max-width: 500px; margin: 0 auto 30px;">
                        Masukkan ID pesanan Anda untuk melihat status pengiriman terkini.
                        Anda akan mendapatkan ID pesanan setelah melakukan pemesanan via WhatsApp.
                    </p>
                    <div class="demo-orders" style="margin-top: 30px;">
                        <p style="color: var(--brown); margin-bottom: 10px; font-size: 14px;">
                            <i class="fas fa-vial"></i> Coba ID demo:
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="demo-id-btn" onclick="testOrder('KD12345')">KD12345</button>
                            <button class="demo-id-btn" onclick="testOrder('KD12346')">KD12346</button>
                            <button class="demo-id-btn" onclick="testOrder('KD12347')">KD12347</button>
                            <button class="demo-id-btn" onclick="testOrder('KD10001')">KD10001</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Kopi Susu Mrs. DK</h3>
                    <p>Menghadirkan kenikmatan kopi susu dengan cita rasa autentik sejak 2015. Setiap cangkir dibuat dengan penuh cinta dan bahan-bahan terbaik.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="https://wa.me/6285298055758" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Kontak Kami</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt"></i> Citra Indah,Jonggol</p>
                        <p><i class="fas fa-phone"></i> 021-1234-5678</p>
                        <p><i class="fab fa-whatsapp"></i> 0852-9805-5758</p>
                        <p><i class="fas fa-envelope"></i> hello@kopisusumrsdk.com</p>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Jam Operasional</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-clock"></i> Senin - Jumat: 07:00 - 21:00</p>
                        <p><i class="fas fa-clock"></i> Sabtu - Minggu: 08:00 - 22:00</p>
                        <p><i class="fas fa-shipping-fast"></i> Pengiriman: Setiap hari 08:00 - 20:00</p>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 Kopi Susu Mrs. DK. Semua hak dilindungi undang-undang.</p>
            </div>
        </div>
    </footer>

    <script>
        // ================================
        // INITIAL DATA & VARIABLES
        // ================================
        let orderItems = [];
        let totalPrice = 0;
        let whatsappMessage = "";
        let orderNumber = "";
        
        // Google Maps variables
        let map;
        let marker;
        let geocoder;
        let autocomplete;
        let userLocation = { lat: -6.4553553, lng: 107.0379105 }; // Default: Jonggol
        let isMapInitialized = false;
        let placesService;

        // Tracking auto-refresh
        let autoRefreshInterval;

        // ================================
        // INITIALIZATION
        // ================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing...');
            // Setup store status monitoring
		setupStoreStatusListener();
            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                const navMenu = document.getElementById('navMenu');
                navMenu.classList.toggle('active');
            });
            
            // Pastikan input dapat difokus di mobile
            const locationInput = document.getElementById('location-search');
            locationInput.removeAttribute('readonly');
            locationInput.style.cursor = 'text';
            
            // Inisialisasi Google Maps setelah DOM siap
            setTimeout(initGoogleMaps, 1000);
            
            // Setup custom autocomplete untuk akurasi yang lebih baik
            setupCustomAutocomplete();
            
            // Setup product quantity controls
            setupProductControls();
            
            // Setup order form
            setupOrderForm();
            
            // Setup tracking system
            initTrackingSystem();
            
            // Auto-load last order
            autoLoadLastOrder();
            
            // Setup smooth scrolling
            setupSmoothScrolling();
        });

        // ================================
        // IMAGE HANDLING FUNCTIONS
        // ================================
        function handleImageError(imgElement, productType) {
            const parent = imgElement.parentElement;
            const fallbackIcon = parent.querySelector('.fallback-icon');
            
            imgElement.style.display = 'none';
            
            if (fallbackIcon) {
                fallbackIcon.style.display = 'flex';
            }
            
            console.warn(`Gambar gagal dimuat: ${imgElement.src}`);
        }

        // ================================
        // GOOGLE MAPS FUNCTIONS
        // ================================
        function initGoogleMaps() {
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps API not loaded');
                showAlert('Info', 'Google Maps sedang dimuat...');
                setTimeout(initGoogleMaps, 2000);
                return;
            }
            
            try {
                geocoder = new google.maps.Geocoder();
                placesService = new google.maps.places.PlacesService(document.createElement('div'));
                console.log('Google Maps API loaded successfully');
            } catch (error) {
                console.error('Error initializing Google Maps:', error);
            }
        }


// ================================
// STORE STATUS CHECK
// ================================
function checkStoreStatus() {
    const status = localStorage.getItem('storeStatus') || 'open';
    const closedMessage = localStorage.getItem('storeClosedMessage') || 
        'Maaf, toko sedang tutup sementara. Silakan pesan pada jam operasional kami.';
    
    if (status === 'closed') {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.id = 'storeClosedOverlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
        `;
        
        overlay.innerHTML = `
            <div style="
                background-color: white;
                border-radius: 20px;
                padding: 40px;
                max-width: 500px;
                width: 100%;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: popIn 0.5s ease;
            ">
                <div style="
                    width: 100px;
                    height: 100px;
                    background-color: #f44336;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 25px;
                ">
                    <i class="fas fa-store-slash" style="font-size: 50px; color: white;"></i>
                </div>
                
                <h2 style="color: #f44336; margin-bottom: 15px; font-family: 'Poppins', sans-serif;">
                    TOKO SEDANG TUTUP
                </h2>
                
                <div style="
                    background-color: #fff3e0;
                    padding: 20px;
                    border-radius: 10px;
                    margin: 20px 0;
                    text-align: left;
                    border-left: 4px solid #ff9800;
                ">
                    <p style="color: #5d4037; margin: 0;">
                        <i class="fas fa-exclamation-triangle" style="color: #ff9800;"></i>
                        ${closedMessage}
                    </p>
                </div>
                
                <div style="color: #666; margin: 25px 0; text-align: left;">
                    <p style="margin-bottom: 10px;">
                        <i class="fas fa-clock"></i> <strong>Jam Operasional:</strong>
                    </p>
                    <ul style="padding-left: 20px; margin: 0;">
                        <li>Senin - Jumat: 07:00 - 21:00</li>
                        <li>Sabtu - Minggu: 08:00 - 22:00</li>
                    </ul>
                </div>
                
                <button onclick="location.reload()" style="
                    background-color: var(--light-green);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    border-radius: 12px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    margin-top: 10px;
                ">
                    <i class="fas fa-sync-alt"></i> Refresh Status
                </button>
                
                <p style="font-size: 12px; color: #999; margin-top: 20px;">
                    <i class="fas fa-info-circle"></i> Status toko diupdate oleh admin
                </p>
            </div>
        `;
        
        document.body.appendChild(overlay);
        
        // Disable order buttons
        document.querySelectorAll('.qty-btn, .quantity-input, #sendToWhatsApp').forEach(el => {
            el.style.pointerEvents = 'none';
            el.style.opacity = '0.5';
        });
        
        return false;
    }
    
    return true;
}

function updateProductAvailability(isAvailable) {
    const buttons = document.querySelectorAll('.qty-btn, .quantity-input');
    const orderButton = document.getElementById('sendToWhatsApp');
    
    if (!isAvailable) {
        buttons.forEach(btn => {
            btn.style.pointerEvents = 'none';
            btn.style.opacity = '0.5';
        });
        
        if (orderButton) {
            orderButton.style.pointerEvents = 'none';
            orderButton.style.opacity = '0.5';
            orderButton.disabled = true;
        }
    } else {
        buttons.forEach(btn => {
            btn.style.pointerEvents = 'auto';
            btn.style.opacity = '1';
        });
        
        if (orderButton) {
            orderButton.style.pointerEvents = 'auto';
            orderButton.style.opacity = '1';
            orderButton.disabled = false;
        }
    }
}

// ================================
// LISTEN FOR STORE STATUS CHANGES
// ================================
function setupStoreStatusListener() {
    // Check initial status
    setTimeout(() => {
        if (!checkStoreStatus()) {
            updateProductAvailability(false);
        }
    }, 1000);
    
    // Listen for status changes
    window.addEventListener('storage', function(e) {
        if (e.key === 'storeStatus' || e.key === 'storeStatusChanged') {
            console.log('Store status changed, reloading...');
            setTimeout(() => {
                location.reload();
            }, 500);
        }
    });
    
    // Periodically check status (every 30 seconds)
    setInterval(() => {
        const status = localStorage.getItem('storeStatus') || 'open';
        updateProductAvailability(status === 'open');
    }, 30000);
}


        function setupCustomAutocomplete() {
            const locationInput = document.getElementById('location-search');
            const suggestionsContainer = document.getElementById('autocompleteSuggestions');
            
            let debounceTimer;
            locationInput.addEventListener('input', function(e) {
                clearTimeout(debounceTimer);
                const searchTerm = this.value.trim();
                
                if (searchTerm.length < 3) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }
                
                debounceTimer = setTimeout(() => {
                    searchPlacesWithDebounce(searchTerm);
                }, 300);
            });
            
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.location-search')) {
                    suggestionsContainer.style.display = 'none';
                }
            });
            
            locationInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const searchTerm = this.value.trim();
                    if (searchTerm.length > 2) {
                        searchPlaceByName(searchTerm);
                        suggestionsContainer.style.display = 'none';
                    }
                }
            });
        }

        function searchPlacesWithDebounce(searchTerm) {
            if (!window.google || !google.maps || !google.maps.places) {
                showSimpleSuggestions(searchTerm);
                return;
            }
            
            if (!placesService) {
                placesService = new google.maps.places.PlacesService(document.createElement('div'));
            }
            
            const request = {
                query: searchTerm + ' Indonesia',
                fields: ['name', 'formatted_address', 'geometry']
            };
            
            placesService.findPlaceFromQuery(request, function(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK && results && results.length > 0) {
                    showSuggestions(results);
                } else {
                    showSimpleSuggestions(searchTerm);
                }
            });
        }

        function showSuggestions(places) {
            const suggestionsContainer = document.getElementById('autocompleteSuggestions');
            suggestionsContainer.innerHTML = '';
            
            places.slice(0, 5).forEach(place => {
                const suggestion = document.createElement('div');
                suggestion.className = 'autocomplete-suggestion';
                suggestion.innerHTML = `
                    <div style="font-weight: 600; color: #333;">${place.name}</div>
                    <div style="font-size: 12px; color: #666;">${place.formatted_address || ''}</div>
                `;
                
                suggestion.addEventListener('click', function() {
                    document.getElementById('location-search').value = place.name;
                    selectPlace(place);
                    suggestionsContainer.style.display = 'none';
                });
                
                suggestionsContainer.appendChild(suggestion);
            });
            
            suggestionsContainer.style.display = 'block';
        }

        function showSimpleSuggestions(searchTerm) {
            const suggestionsContainer = document.getElementById('autocompleteSuggestions');
            suggestionsContainer.innerHTML = '';
            
            const commonSuggestions = [
                `${searchTerm}, Jakarta`,
                `${searchTerm}, Jakarta Selatan`,
                `${searchTerm}, Jakarta Pusat`,
                `${searchTerm}, Indonesia`
            ];
            
            commonSuggestions.forEach(suggestion => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'autocomplete-suggestion';
                suggestionElement.textContent = suggestion;
                
                suggestionElement.addEventListener('click', function() {
                    document.getElementById('location-search').value = suggestion;
                    searchPlaceByName(suggestion);
                    suggestionsContainer.style.display = 'none';
                });
                
                suggestionsContainer.appendChild(suggestionElement);
            });
            
            suggestionsContainer.style.display = 'block';
        }

        function selectPlace(place) {
            if (place.geometry) {
                userLocation = {
                    lat: place.geometry.location.lat(),
                    lng: place.geometry.location.lng()
                };
                
                const address = place.formatted_address || place.name;
                document.getElementById('customer-address').value = address;
                
                showMapWithLocation(userLocation);
                showAlert('Lokasi Ditemukan', 'Alamat telah berhasil ditemukan.');
            } else {
                searchPlaceByName(place.name);
            }
        }

        function searchPlaceByName(placeName) {
            if (!placeName || placeName.trim() === '') return;
            
            showAlert('Mencari...', 'Mencari "' + placeName + '"...');
            
            if (!geocoder) {
                showAlert('Error', 'Geocoder tidak tersedia. Silakan refresh halaman.');
                return;
            }
            
            const query = placeName.includes(',') ? placeName : `${placeName}, Indonesia`;
            
            geocoder.geocode({ 
                address: query,
                region: 'ID',
                bounds: new google.maps.LatLngBounds(
                    new google.maps.LatLng(-6.5, 106.2),
                    new google.maps.LatLng(-5.8, 107.0)
                )
            }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    userLocation = {
                        lat: results[0].geometry.location.lat(),
                        lng: results[0].geometry.location.lng()
                    };
                    
                    document.getElementById('customer-address').value = results[0].formatted_address;
                    document.getElementById('location-search').value = results[0].formatted_address;
                    
                    showMapWithLocation(userLocation);
                    showAlert('Lokasi Ditemukan', 'Alamat telah berhasil ditemukan.');
                } else {
                    geocoder.geocode({ 
                        address: query,
                        region: 'ID'
                    }, (results2, status2) => {
                        if (status2 === 'OK' && results2[0]) {
                            userLocation = {
                                lat: results2[0].geometry.location.lat(),
                                lng: results2[0].geometry.location.lng()
                            };
                            
                            document.getElementById('customer-address').value = results2[0].formatted_address;
                            document.getElementById('location-search').value = results2[0].formatted_address;
                            
                            showMapWithLocation(userLocation);
                            showAlert('Lokasi Ditemukan', 'Alamat telah berhasil ditemukan.');
                        } else {
                            showAlert('Tidak Ditemukan', 'Lokasi tidak ditemukan. Silakan coba alamat yang lebih spesifik atau gunakan alamat manual.');
                        }
                    });
                }
            });
        }

        // Event listener untuk tombol pencarian manual
        document.getElementById('manualSearchBtn').addEventListener('click', function() {
            const searchText = document.getElementById('location-search').value.trim();
            if (searchText.length > 2) {
                searchPlaceByName(searchText);
                document.getElementById('autocompleteSuggestions').style.display = 'none';
            } else {
                showAlert('Input Kosong', 'Silakan ketik nama tempat atau alamat terlebih dahulu.');
            }
        });

        // Detect current location button
        document.getElementById('detectLocation').addEventListener('click', function() {
            if (navigator.geolocation) {
                showAlert('Mendeteksi Lokasi', 'Mengambil lokasi Anda...');
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        updateAddressFromLocation(userLocation);
                        showMapWithLocation(userLocation);
                        showAlert('Lokasi Ditemukan', 'Lokasi Anda telah berhasil dideteksi.');
                    },
                    (error) => {
                        showAlert('Gagal Mendeteksi', 'Tidak dapat mengambil lokasi. Silakan cari alamat manual.');
                    },
                    { 
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                showAlert('Browser Tidak Mendukung', 'Browser Anda tidak mendukung deteksi lokasi.');
            }
        });

        // Show map button
        document.getElementById('showMap').addEventListener('click', function() {
            const mapContainer = document.getElementById('mapContainer');
            if (mapContainer.style.display === 'block') {
                mapContainer.style.display = 'none';
            } else {
                mapContainer.style.display = 'block';
                
                if (typeof google === 'undefined' || !google.maps) {
                    showAlert('Loading...', 'Sedang memuat Google Maps...');
                    setTimeout(() => {
                        if (typeof google !== 'undefined' && google.maps) {
                            showMapWithLocation(userLocation);
                        } else {
                            showAlert('Error', 'Google Maps gagal dimuat. Silakan refresh halaman.');
                        }
                    }, 2000);
                } else {
                    showMapWithLocation(userLocation);
                }
            }
        });

        function initMapWithLocation(location) {
            try {
                const mapElement = document.getElementById('address-map');
                if (!mapElement) {
                    console.error('Map element not found');
                    return;
                }
                
                map = new google.maps.Map(mapElement, {
                    center: location,
                    zoom: 16,
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: true,
                    zoomControl: true,
                    gestureHandling: 'greedy'
                });
                
                marker = new google.maps.Marker({
                    map: map,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                    position: location,
                    title: 'Lokasi Pengiriman'
                });
                
                google.maps.event.addListener(marker, 'dragend', function() {
                    updateAddressFromLocation(marker.getPosition());
                });
                
                isMapInitialized = true;
            } catch (error) {
                console.error('Error initializing map:', error);
            }
        }

        function showMapWithLocation(location) {
            if (!isMapInitialized || !map) {
                initMapWithLocation(location);
            } else {
                map.setCenter(location);
                if (marker) {
                    marker.setPosition(location);
                } else {
                    marker = new google.maps.Marker({
                        map: map,
                        draggable: true,
                        position: location
                    });
                }
                map.setZoom(16);
            }
            
            setTimeout(() => {
                if (map) {
                    google.maps.event.trigger(map, 'resize');
                }
            }, 300);
        }

        function updateAddressFromLocation(location) {
            if (!geocoder) {
                console.error('Geocoder not initialized');
                return;
            }
            
            geocoder.geocode({ location: location }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    document.getElementById('customer-address').value = results[0].formatted_address;
                    document.getElementById('location-search').value = results[0].formatted_address;
                    updateReceiptPreview();
                }
            });
        }

        // ================================
        // PRODUCT & ORDER FUNCTIONS
        // ================================
        function setupProductControls() {
            document.querySelectorAll('.qty-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product');
                    const productName = this.getAttribute('data-name');
                    const productPrice = parseInt(this.getAttribute('data-price'));
                    const input = document.getElementById(`qty-${productId}`);
                    const statusElement = document.getElementById(`status-${productId}`);
                    
                    let value = parseInt(input.value) || 0;
                    
                    if (this.classList.contains('plus')) {
                        value++;
                    } else if (this.classList.contains('minus') && value > 0) {
                        value--;
                    }
                    
                    input.value = value;
                    
                    if (value > 0) {
                        statusElement.textContent = `${value} x ditambahkan`;
                        statusElement.style.color = 'var(--light-green)';
                    } else {
                        statusElement.textContent = '';
                    }
                    
                    updateOrderItem(productId, productName, productPrice, value);
                    updateOrderSummary();
                    updateReceiptPreview();
                });
            });

            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', function() {
                    const productId = this.id.split('-')[1];
                    const productCard = this.closest('.product-card');
                    const productName = productCard.querySelector('h3').textContent;
                    const productPrice = parseInt(productCard.querySelector('.price').textContent.replace(/\D/g, ''));
                    const value = parseInt(this.value) || 0;
                    const statusElement = document.getElementById(`status-${productId}`);
                    
                    if (value < 0) this.value = 0;
                    
                    if (value > 0) {
                        statusElement.textContent = `${value} x ditambahkan`;
                        statusElement.style.color = 'var(--light-green)';
                    } else {
                        statusElement.textContent = '';
                    }
                    
                    updateOrderItem(productId, productName, productPrice, value);
                    updateOrderSummary();
                    updateReceiptPreview();
                });
            });
        }

        function updateOrderItem(productId, productName, productPrice, quantity) {
            const existingItemIndex = orderItems.findIndex(item => item.id == productId);
            
            if (quantity > 0) {
                if (existingItemIndex > -1) {
                    orderItems[existingItemIndex].quantity = quantity;
                } else {
                    orderItems.push({
                        id: productId,
                        name: productName,
                        price: productPrice,
                        quantity: quantity
                    });
                }
            } else {
                if (existingItemIndex > -1) {
                    orderItems.splice(existingItemIndex, 1);
                }
            }
        }

        function updateOrderSummary() {
            const orderItemsElement = document.getElementById('order-items');
            totalPrice = 0;
            
            if (orderItems.length === 0) {
                orderItemsElement.innerHTML = `
                    <div class="empty-order">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Belum ada pesanan</p>
                        <p style="font-size: 14px; margin-top: 10px;">Gunakan tombol + dan - pada produk untuk menambahkan pesanan</p>
                    </div>
                `;
            } else {
                let itemsHTML = '';
                orderItems.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    totalPrice += itemTotal;
                    
                    itemsHTML += `
                        <div class="order-item">
                            <div class="order-item-info">
                                <div class="order-item-name">${item.name}</div>
                                <div class="order-item-qty">${item.quantity} x Rp ${item.price.toLocaleString('id-ID')}</div>
                            </div>
                            <div class="order-item-price">Rp ${itemTotal.toLocaleString('id-ID')}</div>
                        </div>
                    `;
                });
                
                orderItemsElement.innerHTML = itemsHTML;
            }
            
            document.getElementById('total-price').textContent = `Rp ${totalPrice.toLocaleString('id-ID')}`;
        }

        function updateReceiptPreview() {
            const receiptItems = document.getElementById('receiptItems');
            const receiptPreview = document.getElementById('receiptPreview');
            
            if (orderItems.length > 0) {
                let itemsHTML = '';
                let subtotal = 0;
                
                orderItems.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    
                    itemsHTML += `
                        <div class="receipt-item">
                            <span>${item.name} (${item.quantity}x)</span>
                            <span>Rp ${itemTotal.toLocaleString('id-ID')}</span>
                        </div>
                    `;
                });
                
                receiptItems.innerHTML = itemsHTML;
                document.getElementById('receiptTotal').textContent = `Rp ${subtotal.toLocaleString('id-ID')}`;
                receiptPreview.style.display = 'block';
            } else {
                receiptPreview.style.display = 'none';
            }
        }

        // ================================
        // ORDER FORM FUNCTIONS
        // ================================
        function setupOrderForm() {
            document.getElementById('sendToWhatsApp').addEventListener('click', sendOrderToWhatsApp);
        }

        // Deteksi browser dan device
        function detectBrowserAndDevice() {
            const userAgent = navigator.userAgent;
            
            return {
                isIOS: /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream,
                isAndroid: /Android/.test(userAgent),
                isOpera: /OPR|Opera/.test(userAgent),
                isSafari: /Safari/.test(userAgent) && !/Chrome/.test(userAgent),
                isChrome: /Chrome/.test(userAgent) && !/Edg/.test(userAgent),
                isFirefox: /Firefox/.test(userAgent),
                isMobile: /Mobi|Android|iPhone|iPad|iPod|Opera Mini/i.test(userAgent),
                isDesktop: !/Mobi|Android|iPhone|iPad|iPod|Opera Mini/i.test(userAgent)
            };
        }

        // Fungsi universal untuk buka WhatsApp
        function openWhatsAppUniversal(message, orderId) {
            const detection = detectBrowserAndDevice();
            const encodedMessage = encodeURIComponent(message);
            const whatsappNumber = '6285298055758';
            
            console.log('Device detection:', detection);
            
            // Simpan message untuk fallback
            localStorage.setItem('whatsappMessage', message);
            localStorage.setItem('lastOrderId', orderId);
            
            // Method URLs
            const urls = {
                web: `https://web.whatsapp.com/send?phone=${whatsappNumber}&text=${encodedMessage}`,
                api: `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodedMessage}`,
                app: `whatsapp://send?phone=${whatsappNumber}&text=${encodedMessage}`,
                intent: `intent://send?phone=${whatsappNumber}&text=${encodedMessage}#Intent;scheme=whatsapp;package=com.whatsapp;end`
            };
            
            // Strategi berdasarkan device
            if (detection.isIOS || detection.isOpera) {
                // iOS/Opera - gunakan popup dengan pilihan
                showIOSWhatsAppInstructions(orderId, urls.web, urls.app, urls.api);
                showAlert('Pesanan Siap!', `Pesanan ${orderId} telah dicatat. Pilih metode WhatsApp.`);
            } 
            else if (detection.isAndroid) {
                // Android - coba langsung buka app
                showAlert('Membuka WhatsApp...', `Pesanan ${orderId} sedang dibuka di WhatsApp...`);
                
                setTimeout(() => {
                    // Coba intent dulu
                    window.location.href = urls.intent;
                    
                    // Fallback ke app URL
                    setTimeout(() => {
                        if (document.hidden === false) {
                            window.location.href = urls.app;
                            
                            // Fallback ke web
                            setTimeout(() => {
                                if (document.hidden === false) {
                                    window.open(urls.web, '_blank');
                                }
                            }, 1000);
                        }
                    }, 500);
                }, 1500);
            }
            else {
                // Desktop - langsung buka WhatsApp Web
                showAlert('Membuka WhatsApp Web...', `Pesanan ${orderId} sedang dibuka...`);
                
                setTimeout(() => {
                    window.open(urls.web, '_blank');
                }, 1500);
            }
            
            // Reset form setelah delay
            setTimeout(() => {
                resetOrderForm();
            }, 3000);
        }

        // Fungsi untuk menampilkan instruksi WhatsApp untuk iOS
        function showIOSWhatsAppInstructions(orderId, webURL, appURL, iosURL) {
            // Hapus popup sebelumnya jika ada
            const existingPopup = document.getElementById('iosWhatsAppPopup');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            const popupHTML = `
                <div id="iosWhatsAppPopup" class="ios-popup-overlay">
                    <div class="ios-popup-container">
                        <div class="ios-popup-header">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        
                        <h3 class="ios-popup-title">Buka WhatsApp</h3>
                        
                        <p class="ios-popup-subtitle">
                            Pesanan <strong style="color: var(--light-green);">#${orderId}</strong> telah siap!<br>
                            Pilih metode pengiriman di bawah:
                        </p>
                        
                        <div class="ios-popup-buttons">
                            <button onclick="openWhatsAppIOSMethod('app', '${appURL}')" 
                                    class="ios-popup-btn ios-popup-btn-primary">
                                <i class="fab fa-whatsapp"></i> WhatsApp App
                            </button>
                            
                            <button onclick="openWhatsAppIOSMethod('web', '${webURL}')" 
                                    class="ios-popup-btn ios-popup-btn-secondary">
                                <i class="fas fa-desktop"></i> WhatsApp Web
                            </button>
                            
                            <button onclick="copyWhatsAppMessage('${orderId}')" 
                                    class="ios-popup-btn ios-popup-btn-tertiary">
                                <i class="fas fa-copy"></i> Salin Pesan
                            </button>
                        </div>
                        
                        <div class="ios-popup-instruction">
                            <p style="margin-bottom: 10px;">
                                <i class="fas fa-lightbulb"></i> Tips:
                            </p>
                            <p style="font-size: 11px;">
                                1. <strong>WhatsApp App</strong>: Langsung buka aplikasi WhatsApp<br>
                                2. <strong>WhatsApp Web</strong>: Buka di browser<br>
                                3. <strong>Salin Pesan</strong>: Paste manual di WhatsApp
                            </p>
                        </div>
                        
                        <button onclick="closeIOSPopup()" class="ios-popup-close">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', popupHTML);
            
            // Auto-close setelah 30 detik
            setTimeout(() => {
                closeIOSPopup();
            }, 30000);
        }

        // Fungsi untuk membuka WhatsApp di iOS
        function openWhatsAppIOSMethod(method, url) {
            console.log(`Opening WhatsApp via ${method}: ${url}`);
            
            if (method === 'app') {
                // Coba buka WhatsApp app
                window.location.href = url;
                
                // Fallback ke WhatsApp Web jika gagal
                setTimeout(() => {
                    if (document.hidden || document.webkitHidden) {
                        // App berhasil dibuka
                        console.log('WhatsApp app opened successfully');
                    } else {
                        // App gagal, buka WhatsApp Web
                        console.log('WhatsApp app failed, opening WhatsApp Web');
                        window.open(url.replace('whatsapp://', 'https://web.whatsapp.com/'), '_blank');
                    }
                }, 1000);
            } else if (method === 'web') {
                // Buka WhatsApp Web
                window.open(url, '_blank');
            }
            
            // Tutup popup
            closeIOSPopup();
            
            // Reset form setelah beberapa detik
            setTimeout(() => {
                resetOrderForm();
            }, 2000);
        }

        // Fungsi untuk copy pesan ke clipboard
        function copyWhatsAppMessage(orderId) {
            const message = localStorage.getItem('whatsappMessage');
            
            // Buat textarea untuk copy
            const textarea = document.createElement('textarea');
            textarea.value = message;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // Untuk mobile
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('Berhasil!', `Pesan pesanan #${orderId} telah disalin ke clipboard.`, 'success');
                    
                    // Beri instruksi untuk paste di WhatsApp
                    setTimeout(() => {
                        alert(`Langkah selanjutnya:\n1. Buka WhatsApp\n2. Cari kontak: 0852-9805-5758\n3. Paste pesan yang sudah disalin\n4. Kirim pesanan Anda!`);
                    }, 500);
                } else {
                    throw new Error('Copy failed');
                }
            } catch (err) {
                console.error('Copy failed:', err);
                showAlert('Gagal', 'Gagal menyalin pesan. Silakan screenshot halaman ini.', 'error');
            }
            
            document.body.removeChild(textarea);
            closeIOSPopup();
            
            // Reset form
            setTimeout(() => {
                resetOrderForm();
            }, 2000);
        }

        // Fungsi untuk menutup popup iOS
        function closeIOSPopup() {
            const popup = document.getElementById('iosWhatsAppPopup');
            if (popup) {
                popup.remove();
            }
        }

// Update fungsi sendOrderToWhatsApp untuk cek status toko
        function sendOrderToWhatsApp() {
            
			 // Cek status toko terlebih dahulu
    const status = localStorage.getItem('storeStatus') || 'open';
    if (status === 'closed') {
        showAlert('Toko Sedang Tutup', 
            'Maaf, toko sedang tutup sementara. Silakan pesan pada jam operasional kami.', 
            'warning');
        return;
    }
			
			
			const customerName = document.getElementById('customer-name').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            const customerAddress = document.getElementById('customer-address').value.trim();
            const manualAddress = document.getElementById('manual-address').value.trim();
            const customerNote = document.getElementById('customer-note').value.trim();
            
            const finalAddress = customerAddress || manualAddress;
            
            // Validasi
            if (!customerName || !customerPhone || !finalAddress) {
                showAlert('Data Tidak Lengkap', 'Harap isi nama, WhatsApp, dan alamat lengkap');
                return;
            }
            
            if (orderItems.length === 0) {
                showAlert('Pesanan Kosong', 'Harap tambahkan minimal satu produk ke pesanan');
                return;
            }
            
            if (!customerPhone.match(/^[0-9]{10,13}$/)) {
                showAlert('Nomor WhatsApp Tidak Valid', 'Harap masukkan 10-13 digit angka');
                return;
            }
            
            orderNumber = 'ORD-' + Date.now().toString().substr(-6);
            document.getElementById('receiptNumber').textContent = orderNumber;
            
            // Generate message
            let receiptItems = '';
            orderItems.forEach(item => {
                receiptItems += ` ${item.name}\n`;
                receiptItems += `  ${item.quantity} x Rp ${item.price.toLocaleString('id-ID')}\n`;
                receiptItems += `  = Rp ${(item.price * item.quantity).toLocaleString('id-ID')}\n\n`;
            });
            
            whatsappMessage = `\n`;
            whatsappMessage += `         *KOPI SUSU MRS. DK*\n`;
            whatsappMessage += `\n\n`;
            whatsappMessage += `           *STRUK PESANAN*\n`;
            whatsappMessage += `No. Pesanan: ${orderNumber}\n`;
            whatsappMessage += `Tanggal: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'})}\n\n`;
            whatsappMessage += `\n`;
            whatsappMessage += `*Detail Pesanan:*\n\n`;
            whatsappMessage += receiptItems;
            whatsappMessage += `\n`;
            whatsappMessage += `*Total:* Rp ${totalPrice.toLocaleString('id-ID')}\n\n`;
            whatsappMessage += `\n`;
            whatsappMessage += `*Data Pemesan:*\n`;
            whatsappMessage += `Nama: ${customerName}\n`;
            whatsappMessage += `WhatsApp: ${customerPhone}\n`;
            whatsappMessage += `Alamat: ${finalAddress}\n\n`;
            
            if (customerNote) {
                whatsappMessage += `*Catatan:*\n${customerNote}\n\n`;
            }
            
            if (customerAddress) {
                whatsappMessage += `*Lokasi Pengiriman:*\n`;
                whatsappMessage += `https://www.google.com/maps?q=${userLocation.lat},${userLocation.lng}\n\n`;
            }
            
            whatsappMessage += `\n`;
            whatsappMessage += `Terima kasih telah memesan di\nKopi Susu Mrs. DK!\n`;
            whatsappMessage += ``;
            
            // Save to admin system
            const orderData = {
                customerName: customerName,
                customerPhone: customerPhone,
                finalAddress: finalAddress,
                customerNote: customerNote,
                totalPrice: totalPrice,
                items: orderItems.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price
                })),
                whatsappMessage: whatsappMessage,
                orderNumber: orderNumber,
                userLocation: userLocation
            };
            
            const adminOrderId = saveOrderToAdminSystem(orderData);
            
            // Update message with admin order ID
            whatsappMessage = whatsappMessage.replace(`No. Pesanan: ${orderNumber}`, `No. Pesanan: ${adminOrderId} (${orderNumber})`);
            
            // Gunakan fungsi universal untuk semua device
            openWhatsAppUniversal(whatsappMessage, adminOrderId);
        }

        function saveOrderToAdminSystem(orderData) {
            const existingOrders = localStorage.getItem('mrsdkOrders');
            let orders = existingOrders ? JSON.parse(existingOrders) : [];
            
            const orderNumber = orders.length + 1;
            const orderId = 'KD' + (10000 + orderNumber).toString().substr(1);
            
            const now = new Date();
            const dateString = now.toISOString().split('T')[0];
            const timeString = now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            }).replace('.', ':');
            
            const adminOrder = {
                id: orderId,
                customer: orderData.customerName,
                customerPhone: orderData.customerPhone,
                address: orderData.finalAddress,
                date: dateString,
                time: timeString,
                total: orderData.totalPrice,
                status: 'diterima',
                items: orderData.items.map(item => ({
                    name: item.name,
                    qty: item.quantity,
                    price: item.price
                })),
                driver: {
                    name: '',
                    phone: '',
                    location: '',
                    eta: ''
                },
                tracking: [
                    {
                        status: 'diterima',
                        time: timeString,
                        date: dateString,
                        note: 'Pesanan diterima dari WhatsApp'
                    }
                ],
                whatsappMessage: orderData.whatsappMessage,
                orderNumber: orderData.orderNumber,
                location: orderData.userLocation,
                customerNote: orderData.customerNote || ''
            };
            
            orders.unshift(adminOrder);
            
            localStorage.setItem('mrsdkOrders', JSON.stringify(orders));
            localStorage.setItem('lastOrderId', orderId);
            localStorage.setItem(`order_${orderId}`, JSON.stringify(adminOrder));
            
            console.log('Order saved to admin system:', adminOrder);
            return orderId;
        }

        function resetOrderForm() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`qty-${i}`).value = 0;
                document.getElementById(`status-${i}`).textContent = '';
            }
            
            orderItems = [];
            updateOrderSummary();
            updateReceiptPreview();
            
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('location-search').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('manual-address').value = '';
            document.getElementById('customer-note').value = '';
            document.getElementById('mapContainer').style.display = 'none';
            
            userLocation = { lat: -6.2088, lng: 106.8456 };
            
            document.getElementById('order-form').scrollIntoView({ behavior: 'smooth' });
            
            showAlert('Pesanan Berhasil Dikirim!', 'Terima kasih telah memesan Kopi Susu Mrs. DK.');
        }

        // ================================
        // TRACKING SYSTEM FUNCTIONS
        // ================================
        function initTrackingSystem() {
            console.log('Initializing tracking system...');
            
            // Setup event listener
            setupTrackingListener();
            
            // Search button handler
            const searchBtn = document.getElementById('searchTrackBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const orderId = document.getElementById('trackOrderId').value.trim();
                    if (!orderId) {
                        showAlert('Error', 'Masukkan ID Pesanan terlebih dahulu');
                        return;
                    }
                    
                    loadAndDisplayTracking(orderId);
                });
            }
            
            // Refresh button handler
            const refreshBtn = document.getElementById('refreshTrackBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    const btn = this;
                    const orderId = document.getElementById('trackOrderId').value.trim();
                    
                    if (!orderId) {
                        showAlert('Error', 'Masukkan ID Pesanan terlebih dahulu');
                        return;
                    }
                    
                    btn.classList.add('refreshing');
                    
                    loadAndDisplayTracking(orderId);
                    
                    setTimeout(() => {
                        btn.classList.remove('refreshing');
                        showAlert('Status Diperbarui', 'Status pesanan telah direfresh');
                    }, 1000);
                });
            }
            
            // Auto-refresh toggle
            const autoRefreshToggle = document.getElementById('autoRefreshToggle');
            if (autoRefreshToggle) {
                autoRefreshToggle.addEventListener('change', function() {
                    if (this.checked) {
                        startAutoRefresh();
                    } else {
                        stopAutoRefresh();
                    }
                });
            }
            
            // Start auto-refresh
            startAutoRefresh();
        }

        function setupTrackingListener() {
            console.log('Setting up tracking listener...');
            
            window.addEventListener('storage', function(e) {
                if (e.key === 'mrsdkOrders') {
                    console.log('Orders updated in storage, refreshing tracking...');
                    refreshTracking();
                }
            });
        }

        function refreshTracking() {
            const currentOrderId = document.getElementById('trackOrderId').value.trim();
            if (currentOrderId) {
                loadAndDisplayTracking(currentOrderId);
            }
        }

        function startAutoRefresh() {
            stopAutoRefresh();
            
            autoRefreshInterval = setInterval(() => {
                const orderId = document.getElementById('trackOrderId').value.trim();
                if (orderId) {
                    loadAndDisplayTracking(orderId);
                }
            }, 10000);
            
            console.log('Auto-refresh started (10 seconds interval)');
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                console.log('Auto-refresh stopped');
            }
        }

        function loadAndDisplayTracking(orderId) {
            console.log('Loading tracking for order:', orderId);
            
            document.getElementById('trackingLoading').style.display = 'block';
            document.getElementById('trackingDefault').style.display = 'none';
            document.getElementById('trackingContent').style.display = 'none';
            
            const savedOrders = localStorage.getItem('mrsdkOrders');
            if (!savedOrders) {
                console.log('No orders found in storage');
                showTrackingError('Tidak ada data pesanan');
                return;
            }
            
            try {
                const orders = JSON.parse(savedOrders);
                console.log('Parsed orders:', orders.length, 'orders');
                console.log('Available order IDs:', orders.map(o => o.id));
                
                const order = orders.find(o => {
                    const normalizedInput = orderId.toUpperCase().trim();
                    const normalizedOrderId = o.id ? o.id.toUpperCase().trim() : '';
                    console.log(`Comparing: "${normalizedInput}" with "${normalizedOrderId}"`);
                    return normalizedOrderId === normalizedInput;
                });
                
                if (order) {
                    console.log('Order found:', order);
                    console.log('Order status:', order.status);
                    console.log('Order tracking:', order.tracking);
                    
                    const fixedOrder = fixOrderDataFormat(order);
                    updateTrackingDisplay(fixedOrder);
                } else {
                    console.log('Order not found. Available orders:', orders);
                    showTrackingError(`Pesanan "${orderId}" tidak ditemukan`);
                }
            } catch (error) {
                console.error('Error parsing orders:', error);
                showTrackingError('Error memuat data pesanan');
            }
        }

        function fixOrderDataFormat(order) {
            const fixedOrder = { ...order };
            
            if (fixedOrder.status) {
                const statusMap = {
                    'diterima': 'diterima',
                    'disiapkan': 'disiapkan',
                    'Disiapkan': 'disiapkan',
                    'pengantaran': 'pengantaran',
                    'sampai': 'sampai',
                    'Sampai': 'sampai'
                };
                
                fixedOrder.status = statusMap[fixedOrder.status] || fixedOrder.status.toLowerCase();
            }
            
            if (!fixedOrder.tracking || !Array.isArray(fixedOrder.tracking)) {
                fixedOrder.tracking = [];
                
                if (fixedOrder.status && fixedOrder.date && fixedOrder.time) {
                    fixedOrder.tracking.push({
                        status: fixedOrder.status,
                        time: fixedOrder.time,
                        date: fixedOrder.date,
                        note: 'Pesanan dibuat'
                    });
                }
            }
            
            if (!fixedOrder.driver || typeof fixedOrder.driver !== 'object') {
                fixedOrder.driver = {
                    name: '',
                    phone: '',
                    location: '',
                    eta: ''
                };
            }
            
            if (!fixedOrder.items || !Array.isArray(fixedOrder.items)) {
                fixedOrder.items = [];
            }
            
            if (typeof fixedOrder.total === 'string') {
                fixedOrder.total = parseInt(fixedOrder.total.replace(/[^0-9]/g, ''));
            }
            
            return fixedOrder;
        }

        function updateTrackingDisplay(order) {
            console.log('Updating tracking display for order:', order.id);
            
            showLiveBadge(true);
            
            document.getElementById('trackingLoading').style.display = 'none';
            document.getElementById('trackingDefault').style.display = 'none';
            document.getElementById('trackingContent').style.display = 'block';
            
            const lastUpdateTime = document.getElementById('lastUpdateTime');
            if (lastUpdateTime) {
                lastUpdateTime.innerHTML = `<i class="fas fa-clock"></i> Update: ${new Date().toLocaleTimeString('id-ID')}`;
            }
            
            const statusProgress = {
                'diterima': 25,
                'disiapkan': 50,
                'pengantaran': 75,
                'sampai': 100
            };
            
            const progressPercent = statusProgress[order.status] || 0;
            
            const statusSteps = [
                { status: 'diterima', icon: 'fa-clipboard-check', label: 'Pesanan Diterima' },
                { status: 'disiapkan', icon: 'fa-coffee', label: 'Sedang Disiapkan' },
                { status: 'pengantaran', icon: 'fa-motorcycle', label: 'Dalam Pengantaran' },
                { status: 'sampai', icon: 'fa-home', label: 'Telah Sampai' }
            ];
            
            let stepsHTML = '';
            statusSteps.forEach(step => {
                const stepData = order.tracking ? order.tracking.find(t => t.status === step.status) : null;
                const isActive = order.status === step.status;
                const isCompleted = order.tracking ? order.tracking.some(t => t.status === step.status) : false;
                
                stepsHTML += `
                    <div class="status-step ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}" 
                         style="animation-delay: ${statusSteps.indexOf(step) * 0.1}s">
                        <div class="status-icon">
                            <i class="fas ${step.icon}"></i>
                        </div>
                        <h4>${step.label}</h4>
                        <p>${stepData ? `${stepData.time} WIB` : 'Menunggu'}</p>
                        ${stepData && stepData.note ? 
                            `<p style="font-size: 12px; color: #666; margin-top: 5px;">${stepData.note}</p>` : ''}
                    </div>
                `;
            });
            
            const driverInfoHTML = order.driver?.name ? `
                <div class="driver-info-card">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="driver-avatar-large">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4 style="color: var(--dark-brown); margin-bottom: 5px;">
                                ${order.driver.name} - Driver
                            </h4>
                            <p style="color: var(--brown); margin-bottom: 5px;">
                                <i class="fas fa-phone-alt"></i> ${order.driver.phone || '-'}
                            </p>
                            <p style="color: var(--brown);">
                                <i class="fas fa-map-marker-alt"></i> ${order.driver.location || 'Lokasi tidak tersedia'}
                            </p>
                        </div>
                    </div>
                </div>
            ` : `
                <div class="driver-info-card" style="background-color: rgba(255, 193, 7, 0.05); text-align: center;">
                    <i class="fas fa-user-clock" style="font-size: 40px; color: #ff9800; margin-bottom: 10px;"></i>
                    <p style="color: var(--dark-brown);">Driver belum ditugaskan</p>
                    <p style="color: var(--brown); font-size: 14px;">Driver akan ditugaskan saat pesanan dalam pengantaran</p>
                </div>
            `;
            
            const etaHTML = order.driver?.eta ? `
                <div class="eta-card">
                    <h4 style="margin-bottom: 5px;">
                        <i class="fas fa-clock"></i> Perkiraan Waktu Tiba
                    </h4>
                    <p style="font-size: 18px; font-weight: 600;">${order.driver.eta}</p>
                </div>
            ` : '';
            
            let itemsHTML = '';
            if (order.items && order.items.length > 0) {
                itemsHTML = `
                    <div class="order-details-card">
                        <h4 style="color: var(--dark-brown); margin-bottom: 15px;">
                            <i class="fas fa-shopping-bag"></i> Detail Pesanan
                        </h4>
                        ${order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dashed #ddd;">
                                <span>${item.name} (${item.qty}x)</span>
                                <span style="font-weight: 600;">Rp ${(item.price * item.qty).toLocaleString('id-ID')}</span>
                            </div>
                        `).join('')}
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 2px solid var(--light-green); font-weight: 600;">
                            <span>TOTAL</span>
                            <span>Rp ${order.total.toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                `;
            }
            
            const trackingContent = document.getElementById('trackingContent');
            trackingContent.innerHTML = `
                <div class="tracking-status-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--dark-brown); margin: 0; font-family: 'Poppins', sans-serif;">
                            <i class="fas fa-box"></i> Pesanan #${order.id}
                        </h3>
                        <span class="order-status-badge ${getStatusClass(order.status)}">
                            ${getStatusText(order.status)}
                        </span>
                    </div>
                    
                    <div class="status-highlight">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas ${getStatusIcon(order.status)}" style="font-size: 30px; color: var(--light-green);"></i>
                            <div>
                                <h4 style="color: var(--dark-brown); margin: 0 0 5px 0;">
                                    ${getStatusMessage(order.status)}
                                </h4>
                                <p style="color: var(--brown); margin: 0; font-size: 14px;">
                                    ${getStatusDescription(order.status)}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--dark-brown); font-weight: 600;">Status Pengiriman</span>
                            <span style="color: var(--light-green); font-weight: 600;">${progressPercent}%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${progressPercent}%"></div>
                        </div>
                    </div>
                    
                    <div class="tracking-status">
                        ${stepsHTML}
                    </div>
                    
                    ${etaHTML}
                    ${driverInfoHTML}
                    ${itemsHTML}
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                        <button class="btn" onclick="refreshTracking()" style="flex: 1;">
                            <i class="fas fa-sync-alt"></i> Refresh Status
                        </button>
                        ${order.status === 'sampai' ? `
                            <button class="btn" style="background-color: #4caf50; color: white; flex: 1;" disabled>
                                <i class="fas fa-check-circle"></i> Pesanan Telah Diterima
                            </button>
                        ` : `
                            <button class="btn" onclick="confirmOrderReceived('${order.id}')" style="background-color: var(--yellow); color: var(--dark-brown); flex: 1;">
                                <i class="fas fa-check-circle"></i> Konfirmasi Diterima
                            </button>
                        `}
                        <button class="btn" onclick="shareTracking('${order.id}')" style="background-color: #2196f3; color: white; flex: 1;">
                            <i class="fas fa-share-alt"></i> Bagikan Status
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #ddd;">
                        <p style="color: #666; font-size: 12px;">
                            <i class="fas fa-history"></i> Terakhir diperbarui: ${new Date().toLocaleString('id-ID')}
                        </p>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                scrollToTracking();
            }, 300);
        }

        function getStatusClass(status) {
            const classes = {
                'diterima': 'status-diterima',
                'disiapkan': 'status-disiapkan',
                'pengantaran': 'status-pengantaran',
                'sampai': 'status-sampai'
            };
            return classes[status] || 'status-diterima';
        }

        function getStatusText(status) {
            const texts = {
                'diterima': 'Diterima',
                'disiapkan': 'Disiapkan',
                'pengantaran': 'Dalam Pengantaran',
                'sampai': 'Telah Sampai'
            };
            return texts[status] || 'Diterima';
        }

        function getStatusIcon(status) {
            const icons = {
                'diterima': 'fa-clipboard-check',
                'disiapkan': 'fa-coffee',
                'pengantaran': 'fa-motorcycle',
                'sampai': 'fa-home'
            };
            return icons[status] || 'fa-clipboard-check';
        }

        function getStatusMessage(status) {
            const messages = {
                'diterima': 'Pesanan Anda telah diterima',
                'disiapkan': 'Pesanan sedang disiapkan',
                'pengantaran': 'Pesanan dalam pengantaran',
                'sampai': 'Pesanan telah sampai'
            };
            return messages[status] || 'Pesanan diterima';
        }

        function getStatusDescription(status) {
            const descriptions = {
                'diterima': 'Tim kami sedang memproses pesanan Anda',
                'disiapkan': 'Barista kami sedang membuat kopi spesial untuk Anda',
                'pengantaran': 'Driver sedang dalam perjalanan ke lokasi Anda',
                'sampai': 'Pesanan telah sampai di tujuan'
            };
            return descriptions[status] || 'Pesanan sedang diproses';
        }

        function showTrackingError(message) {
            document.getElementById('trackingLoading').style.display = 'none';
            document.getElementById('trackingDefault').style.display = 'none';
            document.getElementById('trackingContent').style.display = 'block';
            
            const trackingContent = document.getElementById('trackingContent');
            trackingContent.innerHTML = `
                <div class="tracking-status-card" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 60px; color: #ff9800; margin-bottom: 20px;"></i>
                    <h3 style="color: var(--dark-brown); margin-bottom: 15px; font-family: 'Poppins', sans-serif;">
                        ${message}
                    </h3>
                    <p style="color: var(--brown); margin-bottom: 25px;">
                        Pastikan ID pesanan yang dimasukkan benar.
                    </p>
                    <button class="btn" onclick="showDefaultTracking()" style="margin-right: 10px;">
                        <i class="fas fa-home"></i> Kembali
                    </button>
                    <button class="btn" onclick="testOrder('KD10001')" style="background-color: var(--yellow); color: var(--dark-brown);">
                        <i class="fas fa-vial"></i> Test KD10001
                    </button>
                </div>
            `;
        }

        function showDefaultTracking() {
            document.getElementById('trackingLoading').style.display = 'none';
            document.getElementById('trackingContent').style.display = 'none';
            document.getElementById('trackingDefault').style.display = 'block';
        }

        function showLiveBadge(show) {
            const liveBadge = document.getElementById('liveBadge');
            if (liveBadge) {
                liveBadge.style.display = show ? 'inline-block' : 'none';
            }
        }

        // ================================
        // UTILITY FUNCTIONS
        // ================================
        function autoLoadLastOrder() {
            setTimeout(() => {
                const lastOrderId = localStorage.getItem('lastOrderId');
                if (lastOrderId) {
                    console.log('Auto-loading last order:', lastOrderId);
                    document.getElementById('trackOrderId').value = lastOrderId;
                    
                    loadAndDisplayTracking(lastOrderId);
                    
                    setTimeout(() => {
                        scrollToTracking();
                    }, 500);
                }
            }, 1000);
        }

        function testOrder(orderId) {
            document.getElementById('trackOrderId').value = orderId;
            document.getElementById('searchTrackBtn').click();
        }

        function confirmOrderReceived(orderId) {
            if (confirm('Apakah pesanan sudah Anda terima?')) {
                const savedOrders = localStorage.getItem('mrsdkOrders');
                if (savedOrders) {
                    const orders = JSON.parse(savedOrders);
                    const orderIndex = orders.findIndex(o => o.id === orderId);
                    
                    if (orderIndex !== -1) {
                        orders[orderIndex].status = 'sampai';
                        orders[orderIndex].tracking.push({
                            status: 'sampai',
                            time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                            date: new Date().toISOString().split('T')[0],
                            note: 'Dikonfirmasi diterima oleh customer'
                        });
                        
                        localStorage.setItem('mrsdkOrders', JSON.stringify(orders));
                        
                        loadAndDisplayTracking(orderId);
                        
                        showAlert('Terima Kasih!', 'Pesanan telah dikonfirmasi diterima.');
                    }
                }
            }
        }

        function shareTracking(orderId) {
            const trackingURL = window.location.href.split('#')[0] + '#tracking';
            const shareText = `Lacak pesanan saya #${orderId} di Kopi Susu Mrs. DK: ${trackingURL}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Tracking Pesanan #${orderId}`,
                    text: shareText,
                    url: trackingURL
                });
            } else {
                navigator.clipboard.writeText(shareText);
                showAlert('Berhasil!', 'Link tracking telah disalin ke clipboard');
            }
        }

        function showAlert(title, message, type = 'success') {
            const alertBox = document.getElementById('whatsappAlert');
            const icon = alertBox.querySelector('.alert-icon');
            
            if (type === 'error') {
                icon.innerHTML = '<i class="fas fa-times"></i>';
                icon.style.backgroundColor = '#ff5252';
            } else if (type === 'warning') {
                icon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                icon.style.backgroundColor = '#ff9800';
            } else {
                icon.innerHTML = '<i class="fab fa-whatsapp"></i>';
                icon.style.backgroundColor = '#25D366';
            }
            
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertMessage').textContent = message;
            
            alertBox.style.display = 'block';
            
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3000);
        }

        function setupSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if(targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if(targetElement) {
                        const headerHeight = document.querySelector('header').offsetHeight;
                        const targetPosition = targetElement.offsetTop - headerHeight - 20;
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                        
                        const navMenu = document.getElementById('navMenu');
                        if(window.innerWidth <= 768) {
                            navMenu.classList.remove('active');
                        }
                    }
                });
            });
        }

        function scrollToTracking() {
            const trackingSection = document.getElementById('tracking');
            if (trackingSection) {
                const headerHeight = document.querySelector('header').offsetHeight;
                const targetPosition = trackingSection.offsetTop - headerHeight - 20;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        }

        // ================================
        // DEBUG FUNCTIONS
        // ================================
        function debugOrders() {
            const orders = JSON.parse(localStorage.getItem('mrsdkOrders') || '[]');
            console.log('=== DEBUG ORDERS ===');
            console.log('Total orders:', orders.length);
            
            orders.forEach((order, index) => {
                console.log(`\n[${index}] Order ID: ${order.id}`);
                console.log('Customer:', order.customer);
                console.log('Status:', order.status);
                console.log('Status type:', typeof order.status);
                console.log('Tracking:', order.tracking);
                console.log('Date:', order.date);
                console.log('Time:', order.time);
                console.log('Driver:', order.driver);
                console.log('Items:', order.items);
            });
            
            return orders;
        }

        function findOrderKD10001() {
            const orders = JSON.parse(localStorage.getItem('mrsdkOrders') || '[]');
            const order = orders.find(o => o.id === 'KD10001' || o.id === 'kd10001');
            
            console.log('=== FINDING KD10001 ===');
            if (order) {
                console.log('Found:', order);
                console.log('Status:', order.status);
                console.log('Status after fix:', fixOrderDataFormat(order).status);
            } else {
                console.log('Not found');
                console.log('Available IDs:', orders.map(o => o.id));
            }
            
            return order;
        }

        // Create test data for KD10001
        function createTestOrderKD10001() {
            const testOrder = {
                id: 'KD10001',
                customer: 'Raisya',
                customerPhone: '082189606233',
                address: 'Jl. Test No. 123',
                date: '2025-12-14',
                time: '16:49',
                total: 70000,
                status: 'disiapkan',
                items: [
                    { name: 'Kopi Susu Creamy', qty: 1, price: 15000 },
                    { name: 'Kopi Susu Creamy 1 Liter', qty: 1, price: 55000 }
                ],
                driver: {
                    name: 'Budi Santoso',
                    phone: '081234567890',
                    location: 'Jl. Merdeka No. 45',
                    eta: '15 menit dari tujuan'
                },
                tracking: [
                    { status: 'diterima', time: '16:49', date: '2025-12-14', note: 'Pesanan diterima' },
                    { status: 'disiapkan', time: '16:55', date: '2025-12-14', note: 'Sedang disiapkan' }
                ]
            };
            
            const existingOrders = JSON.parse(localStorage.getItem('mrsdkOrders') || '[]');
            const filteredOrders = existingOrders.filter(o => o.id !== 'KD10001');
            filteredOrders.unshift(testOrder);
            
            localStorage.setItem('mrsdkOrders', JSON.stringify(filteredOrders));
            localStorage.setItem('lastOrderId', 'KD10001');
            
            console.log('Test order KD10001 created');
            loadAndDisplayTracking('KD10001');
        }
    </script>
</body>
</html>